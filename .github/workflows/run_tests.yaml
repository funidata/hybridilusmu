name: Run tests

on:
  workflow_call:

jobs:
  # unit-tests:
  #   name: Unit tests
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3
  #     - name: Set up Docker Buildx
  #       uses: docker/setup-buildx-action@v2
  #     - name: Download artifact
  #       uses: actions/download-artifact@v3
  #       with:
  #         name: hybridilusmu
  #         path: /tmp
  #     - name: Load image
  #       run: |
  #         docker load --input /tmp/hybridilusmu.tar
  #         docker image ls -a
  #     - run: touch .env.development
  #     - name: Start containers
  #       run: docker compose -f compose.yaml -f compose-ci.yaml up -d
  #     - name: Run unit tests
  #       run: npm test
  #     - name: Stop containers
  #       run: npm stop

  integration-tests:
    name: Integration tests
    runs-on: ubuntu-latest
    steps:
      - name: Collect Workflow Telemetry
        uses: runforesight/workflow-telemetry-action@v1
      - name: Checkout
        uses: actions/checkout@v3
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2
      - name: Download artifact
        uses: actions/download-artifact@v3
        with:
          name: hybridilusmu
          path: /tmp
      - name: Load image
        run: |
          docker load --input /tmp/hybridilusmu.tar
          docker image ls -a
      - run: touch .env.development
      - name: Start containers
        run: docker compose -f compose.yaml -f compose-ci.yaml up -d --timeout 600
      - name: Run integration tests
        run: npm run test:integration
      - name: Stop containers
        run: npm stop
